<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Karyashala Bootcamp • Student Reviews</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">

  <style>
    /* ===== Reset ===== */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: "Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; }
    img { max-width: 100%; display: block; }
    button { font: inherit; }
    :root{
      --bg0: #070A12;
      --bg1: #0B1024;

      --text1: rgba(255,255,255,.92);
      --text2: rgba(255,255,255,.72);
      --text3: rgba(255,255,255,.55);

      --card: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.10);

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --shadow2: 0 10px 32px rgba(0,0,0,.35);

      --radius: 22px;

      --indigo: #6366F1;
      --violet: #8B5CF6;
      --amber: #FBBF24;
    }

    body{
      color: var(--text1);
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(99,102,241,.24), transparent 60%),
        radial-gradient(900px 650px at 85% 25%, rgba(139,92,246,.18), transparent 60%),
        linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 100%);
      overflow-x: hidden;
    }

    .wrap{
      width: min(1200px, calc(100% - 28px));
      margin: 0 auto;
    }

    /* ===== Header ===== */
    header{
      padding: 28px 0 12px;
      text-align: center;
    }

    .brand{
      font-family: "Fraunces", serif;
      font-weight: 700;
      letter-spacing: -.02em;
      font-size: clamp(30px, 4.2vw, 52px);
      line-height: 1.05;
      margin: 0;
    }

    .subbrand{
      margin-top: 8px;
      color: var(--text2);
      font-weight: 800;
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 12px;
    }

    /* ===== Stats ===== */
    .stats{
      margin-top: 18px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      align-items: stretch;
    }

    .stat{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px 14px;
      display: grid;
      gap: 8px;
    }

    .stat .label{
      color: var(--text3);
      font-weight: 900;
      letter-spacing: .12em;
      text-transform: uppercase;
      font-size: 11px;
    }

    .stat .value{
      display: flex;
      align-items: baseline;
      justify-content: center;
      gap: 10px;
    }

    .big-num{
      font-weight: 900;
      letter-spacing: -.02em;
      font-variant-numeric: tabular-nums;
      font-size: clamp(34px, 4.4vw, 56px);
      line-height: 1;
    }

    .stars{
      display: inline-flex;
      gap: 2px;
      transform: translateY(3px);
    }

    .star{
      font-size: 14px;
      color: rgba(255,255,255,.18);
    }
    .star.on{
      color: var(--amber);
      filter: drop-shadow(0 0 10px rgba(251,191,36,.22));
    }

    /* ===== Grid ===== */
    main{ padding: 16px 0 28px; }

    .grid{
      margin-top: 14px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    /* Compact card (about 25% less height) */
    .card{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.065), rgba(255,255,255,.040));
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow: hidden;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      min-height: 190px; /* compact */
      position: relative;
    }
    .card:hover{
      transform: translateY(-3px);
      border-color: rgba(99,102,241,.30);
      box-shadow: var(--shadow);
    }

    .card-body{
      padding: 14px 14px 10px;
    }

    /* Big quote highlight */
    .quote{
      font-family: "Plus Jakarta Sans", system-ui, sans-serif;
      font-weight: 800;
      color: rgba(255,255,255,.90);
      font-size: 15px;     /* highlight */
      line-height: 1.6;
      letter-spacing: -.01em;
      white-space: pre-wrap;
      word-break: break-word;

      /* auto-compact inside card */
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 4;   /* keeps height compact */
      overflow: hidden;
    }

    .student{
      margin-top: 10px;
      padding: 10px 14px 12px;
      border-top: 1px solid rgba(255,255,255,.08);
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,.03);
    }

    .avatar{
      width: 44px;
      height: 44px;
      border-radius: 14px;
      object-fit: cover;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.08);
      flex: 0 0 auto;
    }

    .meta{
      min-width: 0;
      display: grid;
      gap: 2px;
    }
    .name{
      font-weight: 900;
      letter-spacing: -.02em;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: rgba(255,255,255,.88);
    }
    .branch{
      font-weight: 800;
      font-size: 11px;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: var(--text3);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ===== Pagination ===== */
    .pager{
      margin-top: 14px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .pgbtn{
      cursor: pointer;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.88);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .10em;
      text-transform: uppercase;
      transition: transform .16s ease, background .16s ease, border-color .16s ease, opacity .16s ease;
      user-select: none;
      min-width: 120px;
    }
    .pgbtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.075); border-color: rgba(255,255,255,.18); }
    .pgbtn:disabled{ opacity: .42; cursor: not-allowed; transform: none; }

    .pageinfo{
      color: var(--text2);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .06em;
      text-transform: uppercase;
      text-align: center;
      flex: 1;
    }

    /* ===== States ===== */
    .state{
      margin-top: 14px;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
      color: var(--text2);
      line-height: 1.6;
      font-weight: 700;
      font-size: 13px;
    }
    .state code{
      display:block;
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
      overflow:auto;
      font-size: 12px;
      font-weight: 700;
    }

    /* ===== Responsive ===== */
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 640px){
      .stats{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .pgbtn{ min-width: 110px; }
    }
  </style>
</head>

<body>
  <header class="wrap">
    <h1 class="brand">AI Karyashala Bootcamp</h1>
    <div class="subbrand">KIET Students Reviews</div>

    <section class="stats" aria-label="Stats">
      <div class="stat">
        <div class="label">Total Reviews</div>
        <div class="value">
          <div class="big-num" id="totalReviews">0</div>
        </div>
      </div>

      <div class="stat">
        <div class="label">Overall Rating</div>
        <div class="value">
          <div class="big-num" id="overallRating">0.0</div>
          <div class="stars" id="ratingStars" aria-label="Rating stars"></div>
        </div>
      </div>
    </section>
  </header>

  <main class="wrap">
    <div id="state" class="state" style="display:none"></div>
    <section id="grid" class="grid" aria-label="Reviews"></section>

    <nav id="pager" class="pager" aria-label="Pagination" style="display:none">
      <button class="pgbtn" id="prevBtn">Prev</button>
      <div class="pageinfo" id="pageInfo">Page 1</div>
      <button class="pgbtn" id="nextBtn">Next</button>
    </nav>
  </main>

  <script>
    // ===== CONFIG (YOUR SUPABASE) =====
    const SUPABASE_URL = "https://scvfcifruoqsjfzptwbf.supabase.co";
    const BUCKET = "photos";
    const DATA_URL = "./students_data.json";

    // ===== UI targets you wanted (fixed display) =====
    const DISPLAY_TOTAL_TARGET = 550;    // show 0 → 550+
    const DISPLAY_RATING_TARGET = 3.8;   // show 0 → 3.8

    // ===== State =====
    let all = [];
    let page = 1;
    const PER_PAGE = 9;

    const $ = (id) => document.getElementById(id);
    function safeStr(v){ return (v === null || v === undefined) ? "" : String(v); }

    function clampRating(x){
      const n = Number(x);
      if (!Number.isFinite(n)) return 0;
      return Math.max(1, Math.min(5, n));
    }

    // Build public URL from: "student_images/FILE.jpg" (or already full URL)
    function publicImageUrl(imagePath){
      let p = safeStr(imagePath).trim();
      if (!p || p.toLowerCase() === "nan" || p.toLowerCase() === "none") return "";
      if (p.startsWith("http://") || p.startsWith("https://")) return p;

      p = p.replace(/^\/+/, "");
      if (p.startsWith(BUCKET + "/")) p = p.slice(BUCKET.length + 1);

      const encoded = p.split("/").map(seg => encodeURIComponent(seg)).join("/");
      return `${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${encoded}`;
    }

    function fallbackAvatarSvg(name){
      const letter = safeStr(name).trim().charAt(0).toUpperCase() || "S";
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#6366F1"/>
              <stop offset="1" stop-color="#8B5CF6"/>
            </linearGradient>
          </defs>
          <rect width="120" height="120" rx="28" fill="url(#g)"/>
          <text x="50%" y="52%" text-anchor="middle" dominant-baseline="middle"
                font-family="Plus Jakarta Sans, Arial" font-weight="900" font-size="56" fill="white">${letter}</text>
        </svg>
      `.trim();
      return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
    }

    function escapeHtml(s){
      return safeStr(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function setState(title, body, extra){
      const box = $("state");
      box.style.display = "block";
      box.innerHTML = `
        <div style="font-weight:900;color:rgba(255,255,255,.92)">${escapeHtml(title)}</div>
        <div style="margin-top:6px">${escapeHtml(body)}</div>
        ${extra ? `<code>${escapeHtml(extra)}</code>` : ""}
      `;
    }
    function clearState(){
      $("state").style.display = "none";
      $("state").innerHTML = "";
    }

    // 0 → target animation
    function animateCount(el, to, opts={}){
      const dur = opts.duration || 900;
      const isFloat = !!opts.float;
      const suffix = opts.suffix || "";
      const start = performance.now();
      const from = 0;

      function tick(now){
        const t = Math.min((now - start)/dur, 1);
        const eased = 1 - Math.pow(1 - t, 3);
        const val = from + (to - from) * eased;
        el.textContent = isFloat ? val.toFixed(1) + suffix : Math.round(val) + suffix;
        if (t < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function renderStars(r){
      const rounded = Math.round(r);
      let html = "";
      for (let i=1;i<=5;i++){
        html += `<span class="star ${i<=rounded ? "on":""}">★</span>`;
      }
      $("ratingStars").innerHTML = html;
    }

    async function loadData(){
      setState("Loading…", "Reading students_data.json");

      const res = await fetch(DATA_URL, { cache: "no-store" });
      if (!res.ok) throw new Error(`students_data.json fetch failed: HTTP ${res.status}`);
      const raw = await res.json();

      all = raw.map((s, idx) => {
        const name = safeStr(s.name || s["Full Name"] || s.full_name).trim() || "Student";
        const branch = safeStr(s.branch || s["Branch"]).trim() || "—";
        const review = safeStr(s.review || s["Review/Comment"] || s.comment).trim() || "No comment provided.";
        const rating = clampRating(s.rating || s["Rating (1-5)"] || s["Rating"]);
        const img = publicImageUrl(s.image || s["Image Path"] || s.image_path || "");

        return { idx: idx+1, name, branch, review, rating, img };
      });

      clearState();

      // You asked: show fixed running numbers
      animateCount($("totalReviews"), DISPLAY_TOTAL_TARGET, { duration: 1100, float: false, suffix: "+" });
      animateCount($("overallRating"), DISPLAY_RATING_TARGET, { duration: 1100, float: true, suffix: "" });
      renderStars(DISPLAY_RATING_TARGET);

      page = 1;
      renderPage();
      wirePager();
    }

    function cardHtml(s){
      const name = escapeHtml(s.name);
      const branch = escapeHtml(s.branch);
      const review = escapeHtml(s.review);
      const img = s.img || fallbackAvatarSvg(s.name);

      return `
        <article class="card">
          <div class="card-body">
            <div class="quote">“${review}”</div>
          </div>
          <div class="student">
            <img class="avatar" src="${img}" alt="${name}"
              onerror="this.onerror=null; this.src='${fallbackAvatarSvg(s.name)}';" />
            <div class="meta">
              <div class="name">${name}</div>
              <div class="branch">${branch}</div>
            </div>
          </div>
        </article>
      `;
    }

    function renderPage(){
      const total = all.length;
      if (!total){
        $("grid").innerHTML = "";
        $("pager").style.display = "none";
        setState("No reviews found", "students_data.json empty ga undi.");
        return;
      }

      const pages = Math.max(1, Math.ceil(total / PER_PAGE));
      if (page > pages) page = pages;

      const start = (page - 1) * PER_PAGE;
      const items = all.slice(start, start + PER_PAGE);

      $("grid").innerHTML = items.map(cardHtml).join("");

      $("pager").style.display = "flex";
      $("prevBtn").disabled = page <= 1;
      $("nextBtn").disabled = page >= pages;

      $("pageInfo").textContent = `Page ${page} • ${start+1}-${Math.min(start+PER_PAGE, total)} of ${total}`;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function wirePager(){
      $("prevBtn").addEventListener("click", () => {
        page = Math.max(1, page - 1);
        renderPage();
      });

      $("nextBtn").addEventListener("click", () => {
        const pages = Math.max(1, Math.ceil(all.length / PER_PAGE));
        page = Math.min(pages, page + 1);
        renderPage();
      });
    }

    loadData().catch(err => {
      $("grid").innerHTML = "";
      $("pager").style.display = "none";
      setState(
        "Unable to load",
        "Fix: index.html and students_data.json same folder lo deploy avvali. Supabase bucket public undali.",
        (err && err.message) ? err.message : String(err)
      );
      console.error(err);
    });
  </script>
</body>
</html>

