<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Karyashala Bootcamp • KIET Student Reviews</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Fraunces:opsz,wght@9..144,600;9..144,700&display=swap" rel="stylesheet">

  <style>
    /* ========= Reset ========= */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      overflow-x: hidden;
      color: rgba(255,255,255,.92);
      background:
        radial-gradient(900px 540px at 12% 10%, rgba(99,102,241,.30), transparent 60%),
        radial-gradient(840px 620px at 86% 20%, rgba(139,92,246,.22), transparent 60%),
        radial-gradient(940px 700px at 52% 95%, rgba(34,211,238,.14), transparent 60%),
        linear-gradient(180deg, #070A12 0%, #0B1024 100%);
    }
    img { max-width: 100%; display: block; }
    button, input, select { font: inherit; }
    a { color: inherit; text-decoration: none; }

    :root{
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.10);
      --border2: rgba(255,255,255,.16);
      --text2: rgba(255,255,255,.70);
      --text3: rgba(255,255,255,.52);
      --shadow: 0 24px 80px rgba(0,0,0,.45);
      --shadow2: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 26px;

      --indigo: #6366F1;
      --violet: #8B5CF6;
      --cyan: #22D3EE;
      --amber: #FBBF24;
    }

    .wrap{
      width: min(1240px, calc(100% - 40px));
      margin: 0 auto;
    }

    /* ========= Topbar ========= */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(7,10,18,.78) 0%, rgba(7,10,18,.55) 100%);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .topbar-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      padding: 14px 0;
    }
    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 0;
    }
    .logo{
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background:
        radial-gradient(10px 10px at 30% 30%, rgba(255,255,255,.65), transparent 70%),
        linear-gradient(135deg, rgba(99,102,241,.95), rgba(139,92,246,.95));
      box-shadow: 0 10px 30px rgba(99,102,241,.22);
      position: relative;
      overflow: hidden;
      flex: 0 0 auto;
    }
    .logo::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.22) 50%, transparent 100%);
      transform: rotate(18deg);
      animation: shine 6s ease-in-out infinite;
    }
    @keyframes shine{
      0%{ transform: translateX(-40%) rotate(18deg); opacity:.0;}
      15%{opacity:.35;}
      40%{ transform: translateX(55%) rotate(18deg); opacity:.0;}
      100%{ opacity:0; transform: translateX(55%) rotate(18deg);}
    }
    .brand-title{
      display:grid;
      gap: 2px;
      min-width: 0;
    }
    .brand-title strong{
      font-weight: 800;
      letter-spacing: -.02em;
      line-height: 1.1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .brand-title span{
      color: var(--text3);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .10em;
      text-transform: uppercase;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .04em;
      white-space: nowrap;
    }
    .pill i{
      width: 9px; height: 9px;
      border-radius: 99px;
      background: linear-gradient(135deg, var(--cyan), var(--indigo));
      box-shadow: 0 0 0 4px rgba(34,211,238,.10);
    }

    /* ========= Hero ========= */
    header.hero{ padding: 22px 0 10px; }
    .hero-card{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.07) 0%, rgba(255,255,255,.045) 100%);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position: relative;
      padding: 18px 18px 16px;
    }
    .hero-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(820px 340px at 12% 10%, rgba(99,102,241,.18), transparent 60%),
        radial-gradient(720px 360px at 88% 65%, rgba(139,92,246,.14), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .hero-card > *{ position:relative; z-index:2; }

    .hero-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 14px;
      flex-wrap: wrap;
    }
    .hero-title{
      margin: 0;
      font-family: "Fraunces", serif;
      font-weight: 700;
      letter-spacing: -.02em;
      font-size: clamp(22px, 3vw, 36px);
      line-height: 1.12;
    }
    .hero-sub{
      margin: 6px 0 0;
      color: var(--text2);
      font-weight: 600;
      line-height: 1.6;
      font-size: 14px;
      max-width: 64ch;
    }

    .metrics{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }
    .metric{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      padding: 12px 12px;
      display:grid;
      gap: 6px;
    }
    .metric .label{
      color: var(--text3);
      font-weight: 900;
      letter-spacing: .10em;
      text-transform: uppercase;
      font-size: 11px;
    }
    .metric .value{
      display:flex;
      align-items:baseline;
      gap: 10px;
      font-variant-numeric: tabular-nums;
    }
    .metric .num{
      font-weight: 900;
      letter-spacing: -.02em;
      font-size: 26px;
      line-height: 1;
    }
    .metric .mini{
      color: rgba(255,255,255,.62);
      font-weight: 800;
      font-size: 12px;
      letter-spacing: .06em;
      text-transform: uppercase;
    }
    .stars{
      display:inline-flex;
      gap: 2px;
      transform: translateY(1px);
    }
    .star{
      font-size: 14px;
      color: rgba(255,255,255,.20);
    }
    .star.on{
      color: var(--amber);
      filter: drop-shadow(0 0 10px rgba(251,191,36,.22));
    }

    /* ========= Grid ========= */
    main{ padding: 12px 0 44px; }
    .state{
      margin-top: 14px;
      padding: 16px;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: var(--shadow2);
      display:grid;
      gap: 8px;
    }
    .state h3{
      margin:0;
      font-weight: 900;
      letter-spacing: -.02em;
      font-size: 16px;
    }
    .state p{
      margin:0;
      color: var(--text2);
      line-height: 1.6;
      font-weight: 600;
      font-size: 13px;
    }
    .state code{
      display:block;
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
      overflow:auto;
      font-size: 12px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
      margin-top: 14px;
    }

    .card{
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,.045) 100%);
      box-shadow: 0 14px 40px rgba(0,0,0,.30);
      overflow:hidden;
      position: relative;
      transition: transform .22s ease, border-color .22s ease, box-shadow .22s ease;
      min-height: 220px;
      display:flex;
      flex-direction: column;
    }
    .card:hover{
      transform: translateY(-4px);
      border-color: rgba(99,102,241,.30);
      box-shadow: 0 24px 70px rgba(0,0,0,.42);
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(520px 220px at 15% 10%, rgba(99,102,241,.14), transparent 60%),
        radial-gradient(420px 240px at 90% 55%, rgba(139,92,246,.10), transparent 60%);
      pointer-events:none;
      opacity:.9;
    }
    .card > *{ position: relative; z-index: 2; }

    /* Big review (main hero inside card) */
    .review{
      padding: 16px 16px 12px;
      flex: 1;
      display:grid;
      gap: 10px;
    }
    .quote{
      font-family: "Fraunces", serif;
      font-weight: 700;
      letter-spacing: -.01em;
      color: rgba(255,255,255,.92);
      line-height: 1.55;
      font-size: 18px; /* BIG focus */
      white-space: pre-wrap;
      word-break: break-word;

      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden;
      -webkit-line-clamp: 4;
    }
    .quote.expanded{ -webkit-line-clamp: unset; }

    .actions{
      display:flex;
      align-items:center;
      justify-content: flex-start;
      gap: 10px;
      margin-top: 2px;
    }
    .ghost{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.82);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .06em;
      text-transform: uppercase;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      display:none; /* shown only when text is clamped */
      user-select:none;
    }
    .ghost:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.20);
      background: rgba(255,255,255,.07);
    }

    /* Footer (small student info) */
    .student{
      padding: 12px 16px 14px;
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .avatar{
      width: 38px; height: 38px;
      border-radius: 14px;
      object-fit: cover;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
      flex: 0 0 auto;
    }
    .meta{
      min-width: 0;
      flex: 1;
      display:grid;
      gap: 2px;
    }
    .name{
      font-weight: 900;
      letter-spacing: -.02em;
      line-height: 1.2;
      font-size: 13px; /* smaller than review */
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .branch{
      color: rgba(255,255,255,.60);
      font-weight: 800;
      font-size: 11px;
      letter-spacing: .10em;
      text-transform: uppercase;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Load more */
    .loadmore-wrap{
      margin-top: 14px;
      display:flex;
      justify-content:center;
    }
    .loadmore{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
      padding: 12px 14px;
      border-radius: 16px;
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .08em;
      text-transform: uppercase;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
    }
    .loadmore:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.075);
      border-color: rgba(255,255,255,.22);
    }
    .loadmore:disabled{
      opacity: .45;
      cursor: not-allowed;
      transform: none;
    }

    /* Responsive */
    @media (max-width: 1020px){
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .metrics{ grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      .wrap{ width: min(1240px, calc(100% - 26px)); }
      .grid{ grid-template-columns: 1fr; }
      .quote{ font-size: 17px; }
    }
    @media (prefers-reduced-motion: reduce){
      .logo::after{ animation:none; }
      .card, .loadmore, .ghost{ transition:none; }
    }
  </style>
</head>

<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="wrap topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand-title">
          <strong>AI Karyashala Bootcamp</strong>
          <span>KIET Student Reviews</span>
        </div>
      </div>
      <div class="pill" title="Static site • Data from students_data.json">
        <i></i> Live • Reviews
      </div>
    </div>
  </div>

  <!-- Hero (only metrics + headings) -->
  <header class="wrap hero" aria-label="Header">
    <section class="hero-card">
      <div class="hero-head">
        <div>
          <h1 class="hero-title">KIET Student Reviews</h1>
          <p class="hero-sub">Only student feedback is highlighted. Names & branch are kept minimal below each review.</p>
        </div>
      </div>

      <div class="metrics" aria-label="Summary metrics">
        <div class="metric">
          <div class="label">Total Reviews</div>
          <div class="value">
            <span class="num" id="mTotal">0</span>
            <span class="mini" id="mTotalSuffix">+</span>
          </div>
        </div>

        <div class="metric">
          <div class="label">Overall Rating</div>
          <div class="value">
            <span class="num" id="mAvg">0.0</span>
            <span class="stars" id="mStars" aria-label="Overall rating stars"></span>
          </div>
        </div>
      </div>
    </section>
  </header>

  <!-- Main -->
  <main class="wrap">
    <div id="state" class="state" style="display:none"></div>
    <section id="grid" class="grid" aria-label="Reviews grid"></section>

    <div class="loadmore-wrap">
      <button id="btnMore" class="loadmore" type="button">Load more</button>
    </div>
  </main>

  <script>
    // ========= CONFIG (yours) =========
    const SUPABASE_URL = "https://scvfcifruoqsjfzptwbf.supabase.co";
    const BUCKET = "photos";
    const DATA_URL = "./students_data.json"; // keep in same folder as index.html

    // ========= UI settings =========
    const BATCH = 12; // cards per load
    const TARGET_TOTAL_REVIEWS = 550;  // animate 0 -> 550+
    const TARGET_OVERALL_RATING = 3.8; // animate 0.0 -> 3.8

    // ========= State =========
    let all = [];
    let shown = 0;

    // ========= Utils =========
    const $ = (id) => document.getElementById(id);
    const safeStr = (v) => (v === null || v === undefined) ? "" : String(v);

    function escapeHtml(s){
      return safeStr(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function clampRating(x){
      const n = Number(x);
      if (!Number.isFinite(n)) return null;
      return Math.max(1, Math.min(5, n));
    }

    // Build a public supabase URL from Excel-like paths.
    // Works with:
    // - "student_images/XYZ.jpg"
    // - "photos/student_images/XYZ.jpg"
    // - "/student_images/XYZ.jpg"
    // - full https URL (returns as-is)
    function publicImageUrl(imagePath){
      let p = safeStr(imagePath).trim();
      if (!p || p.toLowerCase() === "nan" || p.toLowerCase() === "none") return "";
      if (p.startsWith("http://") || p.startsWith("https://")) return p;

      p = p.replace(/^\/+/, ""); // remove leading slashes
      if (p.startsWith(BUCKET + "/")) p = p.slice(BUCKET.length + 1); // remove "photos/"
      // encode each path segment safely
      const encoded = p.split("/").map(seg => encodeURIComponent(seg)).join("/");
      return `${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${encoded}`;
    }

    function fallbackAvatarSvg(name){
      const letter = safeStr(name).trim().charAt(0).toUpperCase() || "S";
      const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#6366F1"/>
              <stop offset="1" stop-color="#8B5CF6"/>
            </linearGradient>
          </defs>
          <rect width="120" height="120" rx="28" fill="url(#g)"/>
          <text x="50%" y="52%" text-anchor="middle" dominant-baseline="middle"
                font-family="Plus Jakarta Sans, Arial" font-weight="900" font-size="56" fill="white">${letter}</text>
        </svg>
      `.trim();
      return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
    }

    function makeStars(r){
      const rounded = Math.round(r);
      let html = "";
      for (let i=1;i<=5;i++){
        html += `<span class="star ${i<=rounded ? "on":""}">★</span>`;
      }
      return html;
    }

    function setState(title, body, extra){
      const box = $("state");
      box.style.display = "grid";
      box.innerHTML = `
        <h3>${escapeHtml(title)}</h3>
        <p>${escapeHtml(body)}</p>
        ${extra ? `<code>${escapeHtml(extra)}</code>` : ""}
      `;
    }
    function clearState(){
      $("state").style.display = "none";
      $("state").innerHTML = "";
    }

    function animateNumber(el, to, opts={}){
      const from = Number(String(el.textContent).replace(/[^\d.]/g,"")) || 0;
      const dur = opts.duration ?? 900;
      const isFloat = !!opts.float;
      const start = performance.now();

      function tick(now){
        const t = Math.min((now - start)/dur, 1);
        const eased = 1 - Math.pow(1 - t, 3);
        const val = from + (to - from) * eased;
        el.textContent = isFloat ? val.toFixed(1) : Math.round(val);
        if (t < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function normalizeRow(s, idx){
      const name = safeStr(s.name || s["Full Name"] || s.full_name).trim() || "Student";
      const branch = safeStr(s.branch || s["Branch"]).trim() || "—";
      const review = safeStr(s.review || s["Review/Comment"] || s.comment).trim() || "No comment provided.";
      const rating = clampRating(s.rating || s["Rating (1-5)"] || s["Rating"]); // optional
      const imgPath = s.image || s["Image Path"] || s.image_path || "";
      const image = publicImageUrl(imgPath);

      return { idx, name, branch, review, rating, image };
    }

    function cardHtml(x){
      const name = escapeHtml(x.name);
      const branch = escapeHtml(x.branch);
      const review = escapeHtml(x.review);
      const img = x.image || fallbackAvatarSvg(x.name);

      return `
        <article class="card">
          <div class="review">
            <div class="quote">${review}</div>
            <div class="actions">
              <button class="ghost" type="button" data-toggle>Read more</button>
            </div>
          </div>

          <div class="student">
            <img class="avatar" src="${img}" alt="${name}"
                 onerror="this.onerror=null; this.src='${fallbackAvatarSvg(x.name)}';" />
            <div class="meta">
              <div class="name">${name}</div>
              <div class="branch">${branch}</div>
            </div>
          </div>
        </article>
      `;
    }

    function renderNext(){
      const grid = $("grid");
      const next = all.slice(shown, shown + BATCH);
      shown += next.length;

      if (!shown){
        setState("No reviews found", "students_data.json is empty or not readable.");
        $("btnMore").disabled = true;
        return;
      }

      grid.insertAdjacentHTML("beforeend", next.map(cardHtml).join(""));

      // show/hide "Read more" only when needed
      requestAnimationFrame(() => {
        grid.querySelectorAll(".card").forEach((card) => {
          const q = card.querySelector(".quote");
          const btn = card.querySelector("[data-toggle]");
          if (!q || !btn) return;
          const clamped = q.scrollHeight > q.clientHeight + 4;
          btn.style.display = clamped ? "inline-flex" : "none";
        });
      });

      // disable load more when finished
      if (shown >= all.length){
        $("btnMore").disabled = true;
        $("btnMore").textContent = "All reviews loaded";
      }
    }

    function wireEvents(){
      $("btnMore").addEventListener("click", renderNext);

      // Toggle read more
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-toggle]");
        if (!btn) return;
        const card = btn.closest(".card");
        const q = card.querySelector(".quote");
        q.classList.toggle("expanded");
        btn.textContent = q.classList.contains("expanded") ? "Show less" : "Read more";
      });
    }

    async function loadData(){
      setState("Loading reviews…", "Fetching students_data.json and preparing the premium view.");
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if (!res.ok) throw new Error(`students_data.json fetch failed: HTTP ${res.status}`);

      const raw = await res.json();
      all = raw.map(normalizeRow);

      clearState();

      // ---- Metrics (as you requested) ----
      // Total Reviews: always animate 0 -> 550+ (stop at 550+)
      animateNumber($("mTotal"), TARGET_TOTAL_REVIEWS, { duration: 1100, float: false });
      $("mTotalSuffix").textContent = "+";

      // Overall rating: animate 0.0 -> 3.8 (stop at 3.8)
      animateNumber($("mAvg"), TARGET_OVERALL_RATING, { duration: 1100, float: true });
      $("mStars").innerHTML = makeStars(TARGET_OVERALL_RATING);

      // ---- Render first batch ----
      shown = 0;
      $("grid").innerHTML = "";
      $("btnMore").disabled = false;
      $("btnMore").textContent = "Load more";
      renderNext();
    }

    async function init(){
      try{
        wireEvents();
        await loadData();
      }catch(err){
        $("grid").innerHTML = "";
        $("btnMore").disabled = true;
        setState(
          "Unable to load data",
          "Fix: make sure students_data.json is deployed next to index.html on Vercel, and Supabase bucket 'photos' is PUBLIC with images in student_images/.",
          `${err && err.message ? err.message : err}\n\nDATA_URL: ${DATA_URL}`
        );
      }
    }

    init();
  </script>
</body>
</html>

